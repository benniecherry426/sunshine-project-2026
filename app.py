import streamlit as st\nimport os\nfrom dotenv import load_dotenv\nfrom modules.speech_handler import SpeechHandler\nfrom modules.document_processor import DocumentProcessor\nfrom modules.data_manager import DataManager\nfrom modules.visualization import Visualization\nimport openai\n\n# Load environment variables\nload_dotenv()\n\n# Set OpenAI API key\nopenai.api_key = os.getenv("OPENAI_API_KEY")\n\n# Page configuration\nst.set_page_config(\n    page_title="Sunshine Project 2026",\n    page_icon="‚òÄÔ∏è",\n    layout="wide",\n    initial_sidebar_state="expanded"\n)\n\n# Initialize session state\nif "messages" not in st.session_state:\n    st.session_state.messages = []\nif "spreadsheet_data" not in st.session_state:\n    st.session_state.spreadsheet_data = {}\nif "categories" not in st.session_state:\n    st.session_state.categories = []\n\n# Initialize modules\nspeech_handler = SpeechHandler()\ndocument_processor = DocumentProcessor()\ndata_manager = DataManager()\nvisualization = Visualization()\n\n# Header\nst.title("‚òÄÔ∏è Sunshine Project 2026")\nst.subtitle("Your Intelligent Accountant AI Chatbot")\n\n# Sidebar\nwith st.sidebar:\n    st.header("Settings")\n    mode = st.radio("Select Mode:", ["Chat", "Upload Documents", "Manage Spreadsheet", "View Dashboard"])\n    \n    if st.button("üé§ Start Voice Input"):\n        st.session_state.voice_active = True\n        st.success("Voice input activated!")\n\n# Main content\nif mode == "Chat":\n    st.header("üí¨ Chat with Your AI Accountant")\n    \n    # Chat interface\n    for message in st.session_state.messages:\n        with st.chat_message(message["role"]):\n            st.write(message["content"])\n    \n    # User input\n    col1, col2 = st.columns([4, 1])\n    with col1:\n        user_input = st.text_input("Type your message or transaction...", placeholder="e.g., I spent $60 on phone bill")\n    with col2:\n        if st.button("Send"):\n            if user_input:\n                st.session_state.messages.append({"role": "user", "content": user_input})\n                \n                # Get AI response\n                response = openai.ChatCompletion.create(\n                    model="gpt-4-turbo",\n                    messages=[{"role": "user", "content": user_input}]\n                )\n                \n                ai_message = response.choices[0].message.content\n                st.session_state.messages.append({"role": "assistant", "content": ai_message})\n                \n                # Text-to-speech\n                speech_handler.text_to_speech(ai_message)\n                st.rerun()\n\nelif mode == "Upload Documents":\n    st.header("üìÑ Upload Financial Documents")\n    \n    uploaded_file = st.file_uploader("Upload PDF, image, or document", type=["pdf", "jpg", "png", "xlsx", "csv"])\n    \n    if uploaded_file:\n        st.write(f"File uploaded: {uploaded_file.name}")\n        \n        # Process document\n        extracted_data = document_processor.process_document(uploaded_file)\n        st.write("Extracted Data:", extracted_data)\n        \n        # Ask for category\n        category = st.text_input("What category is this? (e.g., Utilities, Travel, Office Supplies)")\n        \n        if category and st.button("Save to Spreadsheet"):\n            data_manager.add_transaction(category, extracted_data)\n            st.success(f"Data saved under '{category}'!")\n\nelif mode == "Manage Spreadsheet":\n    st.header("üìä Financial Spreadsheet")\n    \n    # Add category\n    new_category = st.text_input("Add new category:")\n    if st.button("Create Category"):\n        if new_category:\n            st.session_state.categories.append(new_category)\n            st.success(f"Category '{new_category}' created!")\n    \n    # Display spreadsheet\n    if st.session_state.categories:\n        selected_category = st.selectbox("Select category to view:", st.session_state.categories)\n        st.dataframe(data_manager.get_category_data(selected_category))\n\nelif mode == "View Dashboard":\n    st.header("üìà Financial Dashboard")\n    \n    # Generate visualizations\n    col1, col2 = st.columns(2)\n    \n    with col1:\n        st.subheader("Spending by Category")\n        chart = visualization.create_pie_chart(data_manager.get_all_data())\n        st.plotly_chart(chart)\n    \n    with col2:\n        st.subheader("Monthly Trends")\n        chart = visualization.create_line_chart(data_manager.get_all_data())\n        st.plotly_chart(chart)\n\nst.divider()\nst.caption("Sunshine Project 2026 - Powered by OpenAI & Streamlit")\n